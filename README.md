### 基于Telemetry的纳秒级时间同步系统

clone_test_zcf.p4 为可编程交换机数据平面的程序，定义了时间同步系统中节点的数据平面转发逻辑。当数据包未到达最后一跳中间节点时，可编程交换机进行正常的数据包转发，并且在数据包头中记录该节点接收和发出数据包的时间戳；当数据包到达最后一跳中间节点时，可编程交换机除进行上述操作外，还会在egress pipeline处将数据包复制一份到相应端口（Telemetry Controller对应的端口，由控制平面程序指定）。

ctrl_clone_test_zcf.py 为可编程交换机控制平面的测试程序，进行了端口配置、流表下发操作，指定了Telemetry Controller对应的端口，并且对多跳之间、不同端口额定速率及实际数据包发送速率等情况进行了测试，结果显示均可以达到纳秒级别的高精准时间同步。

在多跳之间的一个测试结果如 clone_4hop.pcap 所示（相隔4跳的节点间进行时间同步），Telemetry Controller对该文件进行如下分析：该pcap文件共有10万个数据包，为逻辑上的5万对数据包（前5万个是逻辑上的请求数据包，后5万个为逻辑上的回复数据包），payload里已经记录了进入和离开各个中间节点的时间戳。对这5万对时间数据计算Offset，经过去离群值处理后，将该计算值与实际Offset（即为0）进行比较，可得误差值为2.06纳秒。（对应文中图11，节点相隔4跳时，使用公式(5)+LOF算法得到的结果。）

